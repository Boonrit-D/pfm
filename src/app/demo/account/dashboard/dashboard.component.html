<!-- <p>dashboard works!</p> -->
<div class="mt-4 max-w-screen-xl mx-auto" *ngIf="demoAccount">
  <!-- Heading -->
  <div
    class="lg:flex justify-between flex-wrap md:flex-nowrap items-center pt-2 pb-2 mb-3 text-center md:text-left"
  >
    <h2 class="text-2xl text-gray-900 text-center">
      {{ demoAccount.accountName }}
    </h2>
    <div class="flex items-center justify-center sm:hidden">
      <span>เพิ่มรายการธุรกรรม</span>
    </div>
    <div class="flex items-center justify-center">
      <button
        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded m-1"
        routerLink="/demo/account/{{ demoAccount._id }}/create-transaction"
        [queryParams]="{ amount: 'positive' }"
      >
        <span class="block sm:hidden">เงินเข้า +</span>
        <span class="hidden sm:block">เงินเข้า +</span>
      </button>

      <button
        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded m-1"
        routerLink="/demo/account/{{ demoAccount._id }}/create-transaction"
        [queryParams]="{ amount: 'negative' }"
      >
        <span class="block sm:hidden">เงินออก -</span>
        <span class="hidden sm:block">เงินออก -</span>
      </button>
    </div>
  </div>

  <!-- Spending Overview Chart -->
  <div class="bg-white p-6 rounded-lg shadow-md">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">ภาพรวมของบัญชี</h3>
    <div class="w-full h-60 justify-center flex">
      <div *ngIf="isLoading" class="loading-container">
        <div class="loader"></div>
        <!-- Spinner -->
        <span class="loading-text">Loading...</span>
      </div>
      <canvas
        *ngIf="isBrowser && !isLoading"
        baseChart
        [data]="barChartData"
        [options]="barChartOptions"
        [plugins]="barChartPlugins"
        [legend]="barChartLegend"
        [type]="'bar'"
      >
      </canvas>
    </div>
    <div class="h-80 justify-center flex flex-col md:flex-row mt-5">
      <canvas
        *ngIf="!isLoading"
        baseChart
        [datasets]="pieChartData.datasets"
        [labels]="pieChartData.labels"
        [options]="pieChartOptions"
        [legend]="pieChartLegend"
        [plugins]="pieChartPlugins"
        [type]="'pie'"
      >
      </canvas>
    </div>
  </div>

  <!-- Account Balance Overview -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 mt-5">
    <!-- Total Balance -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-xl font-semibold text-gray-700">ยอดเงินคงเหลือทั้งหมด</h3>
      <span
        [ngClass]="{
          'text-red-500': demoAccount.balance < 0,
          'text-green-500': demoAccount.balance > 0,
          'text-3xl font-bold mt-2': true
        }"
      >
        {{ demoAccount.balance | number : "1.2-2" }} {{ demoAccount.currency }}
      </span>
    </div>

    <!-- Monthly Income -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-xl font-semibold text-gray-700">รายได้ประจำเดือน</h3>
      <p class="text-3xl font-bold text-green-500 mt-2">
        {{ totalIncome | number : "1.2-2" }} {{ demoAccount.currency }}
      </p>
    </div>

    <!-- Monthly Expenses -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-xl font-semibold text-gray-700">ค่าใช้จ่ายรายเดือน</h3>
      <p class="text-3xl font-bold text-red-500 mt-2">
        {{ totalExpenses | number : "1.2-2" }} {{ demoAccount.currency }}
      </p>
    </div>
  </div>

  <!-- Recent Transactions -->
  <div class="bg-white p-6 rounded-lg shadow-md mb-8">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">
      รายการธุรกรรมล่าสุด
    </h3>
    <table class="min-w-full bg-white">
      <thead>
        <tr class="w-full bg-gray-200">
          <th class="py-2 px-4 text-left">วันที่และเวลา</th>
          <th class="py-2 px-4 text-left">หมวดหมู่</th>
          <th class="py-2 px-4 text-right">จำนวนเงิน</th>
        </tr>
      </thead>
      <tbody>
        <!-- Popover -->
        <div
          *ngIf="showPopover"
          class="absolute z-10 w-46 p-1 text-sm text-gray-500 bg-red-100 border border-gray-200 rounded-lg shadow-md opacity-80"
          [ngStyle]="{ top: mouseY + 'px', left: mouseX + 'px' }"
        >
          <span class="border-b font-semibold text-red-500"
            >คลิกเลือกรายการที่ต้องการ!</span
          >
          <br />
          <span> เพื่ออัปเดตหรือแก้ไข </span>
        </div>
        <tr
          *ngFor="
            let demoTransactionsForCurrentAccount of recentTransactions;
            let i = index
          "
          [ngClass]="{
            'even:bg-gray-50': !showPopover,
            'hover:bg-green-100 bg-gray-50 even:bg-white': showPopover
          }"
          routerLink="/demo/account/{{ demoAccount._id }}/update-transaction/{{
            demoTransactionsForCurrentAccount._id
          }}"
          [queryParams]="{
            amount:
              demoTransactionsForCurrentAccount.amount >= 0
                ? 'positive'
                : 'negative'
          }"
          (mouseenter)="showPopover = true"
          (mouseleave)="showPopover = false"
        >
          <td class="py-2 px-4 hidden md:table-cell">
            {{ demoTransactionsForCurrentAccount.date | date : "dd/MM/yyyy" }}
            <br />
            {{ demoTransactionsForCurrentAccount.date | date : "HH:mm:ss" }}
          </td>
          <td class="py-2 px-4 table-cell md:hidden">
            {{ demoTransactionsForCurrentAccount.date | date : "d/M H:mm" }}
          </td>
          <td class="py-2 px-4">
            {{ demoTransactionsForCurrentAccount.category }}
          </td>
          <td class="py-2 px-4 text-right">
            <span
              [ngClass]="{
                'text-red-500': demoTransactionsForCurrentAccount.amount < 0,
                'text-green-500': demoTransactionsForCurrentAccount.amount >= 0
              }"
            >
              {{ demoTransactionsForCurrentAccount.amount | number : "1.2-2" }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
    <button
      class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm mt-2"
      routerLink="/demo/account/{{ demoAccount._id }}/transactions"
    >
      ดูทั้งหมด
    </button>
  </div>
  <!-- Ending -->
</div>
